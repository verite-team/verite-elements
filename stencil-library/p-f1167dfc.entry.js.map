{"version":3,"names":["googleOneTapCss","VuiGoogleOneTapStyle0","GoogleOneTap","this","cleanup","componentDidLoad","script","document","createElement","id","src","async","defer","onload","globalThis","google","oneTapSignInPrompt","_a","accounts","cancel","body","appendChild","disconnectedCallback","initialize","client_id","googleClientId","callback","handleCredentialResponse","bind","cancel_on_tap_outside","itp_support","prompt","response","responsePayload","decodeJWT","credential","email_verified","oauthSignIn","email","token","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","err","console","error","googleError","emit","Error","googleId","client","oauth2","initTokenClient","scope","hint","tokenResponse","googleCredential","provider","access_token","requestAccessToken","render"],"sources":["src/components/google-one-tap/google-one-tap.css?tag=vui-google-one-tap&encapsulation=shadow","src/components/google-one-tap/google-one-tap.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n","import { Component, Event, EventEmitter, Prop } from '@stencil/core'\nimport {\n  GoogleCredentialResponse,\n  GoogleTokenResponse,\n  SignInWithIdTokenCredentials,\n} from './google-one-tap-interfaces'\n\n@Component({\n  tag: 'vui-google-one-tap',\n  styleUrl: 'google-one-tap.css',\n  shadow: true,\n})\nexport class GoogleOneTap {\n  @Prop() googleClientId!: string\n\n  @Event() googleCredential: EventEmitter<SignInWithIdTokenCredentials>\n  @Event() googleError: EventEmitter<Error>\n\n  private cleanup: (() => void) | null = null\n\n  componentDidLoad() {\n    const script = document.createElement('script')\n    script.id = 'google-sign-in'\n    script.src = 'https://accounts.google.com/gsi/client'\n    script.async = true\n    script.defer = true\n\n    script.onload = () => {\n      if (globalThis.google) {\n        this.oneTapSignInPrompt()\n        this.cleanup = () => globalThis.google?.accounts.id.cancel()\n      }\n    }\n\n    document.body.appendChild(script)\n  }\n\n  disconnectedCallback() {\n    if (this.cleanup) {\n      this.cleanup()\n    }\n  }\n\n  private oneTapSignInPrompt() {\n    globalThis.google.accounts.id.initialize({\n      client_id: this.googleClientId,\n      callback: this.handleCredentialResponse.bind(this),\n      cancel_on_tap_outside: false,\n      itp_support: true,\n    })\n    globalThis.google.accounts.id.prompt()\n  }\n\n  private handleCredentialResponse(response: GoogleCredentialResponse) {\n    const responsePayload = this.decodeJWT(response.credential)\n    if (!responsePayload?.email_verified) {\n      this.oneTapSignInPrompt()\n    } else {\n      this.oauthSignIn(responsePayload.email)\n    }\n  }\n\n  private decodeJWT(token: string) {\n    try {\n      const base64Url = token.split('.')[1]\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/')\n      const jsonPayload = decodeURIComponent(\n        atob(base64)\n          .split('')\n          .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\n          .join('')\n      )\n      return JSON.parse(jsonPayload)\n    } catch (err) {\n      console.error('Error decoding JWT:', err)\n      this.googleError.emit(err instanceof Error ? err : new Error('Failed to decode JWT'))\n      return null\n    }\n  }\n\n  private oauthSignIn(googleId: string) {\n    const client = globalThis.google.accounts.oauth2.initTokenClient({\n      client_id: this.googleClientId,\n      scope: 'https://www.googleapis.com/auth/userinfo.profile',\n      hint: googleId,\n      prompt: '',\n      callback: (tokenResponse: GoogleTokenResponse) => {\n        this.googleCredential.emit({\n          provider: 'google',\n          token: tokenResponse.access_token,\n        })\n      },\n    })\n    client.requestAccessToken()\n  }\n\n  render() {\n    return null // Google One Tap UI is injected by the Google script\n  }\n}\n"],"mappings":"2CAAA,MAAMA,EAAkB,uBACxB,MAAAC,EAAeD,E,MCWFE,EAAY,M,qHAMfC,KAAAC,QAA+B,K,8BAEvC,gBAAAC,GACE,MAAMC,EAASC,SAASC,cAAc,UACtCF,EAAOG,GAAK,iBACZH,EAAOI,IAAM,yCACbJ,EAAOK,MAAQ,KACfL,EAAOM,MAAQ,KAEfN,EAAOO,OAAS,KACd,GAAIC,WAAWC,OAAQ,CACrBZ,KAAKa,qBACLb,KAAKC,QAAU,SAAAa,EAAM,OAAAA,EAAAH,WAAWC,UAAM,MAAAE,SAAA,SAAAA,EAAEC,SAAST,GAAGU,QAAQ,C,GAIhEZ,SAASa,KAAKC,YAAYf,E,CAG5B,oBAAAgB,GACE,GAAInB,KAAKC,QAAS,CAChBD,KAAKC,S,EAID,kBAAAY,GACNF,WAAWC,OAAOG,SAAST,GAAGc,WAAW,CACvCC,UAAWrB,KAAKsB,eAChBC,SAAUvB,KAAKwB,yBAAyBC,KAAKzB,MAC7C0B,sBAAuB,MACvBC,YAAa,OAEfhB,WAAWC,OAAOG,SAAST,GAAGsB,Q,CAGxB,wBAAAJ,CAAyBK,GAC/B,MAAMC,EAAkB9B,KAAK+B,UAAUF,EAASG,YAChD,KAAKF,IAAe,MAAfA,SAAe,SAAfA,EAAiBG,gBAAgB,CACpCjC,KAAKa,oB,KACA,CACLb,KAAKkC,YAAYJ,EAAgBK,M,EAI7B,SAAAJ,CAAUK,GAChB,IACE,MAAMC,EAAYD,EAAME,MAAM,KAAK,GACnC,MAAMC,EAASF,EAAUG,QAAQ,KAAM,KAAKA,QAAQ,KAAM,KAC1D,MAAMC,EAAcC,mBAClBC,KAAKJ,GACFD,MAAM,IACNM,KAAIC,GAAK,KAAO,KAAOA,EAAEC,WAAW,GAAGC,SAAS,KAAKC,OAAO,KAC5DC,KAAK,KAEV,OAAOC,KAAKC,MAAMV,E,CAClB,MAAOW,GACPC,QAAQC,MAAM,sBAAuBF,GACrCpD,KAAKuD,YAAYC,KAAKJ,aAAeK,MAAQL,EAAM,IAAIK,MAAM,yBAC7D,OAAO,I,EAIH,WAAAvB,CAAYwB,GAClB,MAAMC,EAAShD,WAAWC,OAAOG,SAAS6C,OAAOC,gBAAgB,CAC/DxC,UAAWrB,KAAKsB,eAChBwC,MAAO,mDACPC,KAAML,EACN9B,OAAQ,GACRL,SAAWyC,IACThE,KAAKiE,iBAAiBT,KAAK,CACzBU,SAAU,SACV9B,MAAO4B,EAAcG,cACrB,IAGNR,EAAOS,oB,CAGT,MAAAC,GACE,OAAO,I","ignoreList":[]}